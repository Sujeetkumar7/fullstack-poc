<div [class.sticky-enabled]="freezeFirstColumn">
  <input
    *ngIf="showFilter"
    type="text"
    class="form-control mb-3 search-input"
    placeholder="Search"
    (keyup)="applyFilter($event)"
  />

  <div class="table-responsive">
    <table
      mat-table
      [dataSource]="dataSource"
      matSort
      class="table align-middle"
      [class.table-hover]="!freezeFirstColumn"
    >
      <ng-container *ngFor="let col of displayedColumns; let i = index" [matColumnDef]="col">
        <th
          mat-header-cell
          *matHeaderCellDef
          mat-sort-header
          class="fw-bold"
          [class.sticky-col]="freezeFirstColumn && i === 0"
          [class.fixed-col]="freezeFirstColumn && i !== 0"
        >
          {{ columnNames[col] || col }}
        </th>

        <td
          mat-cell
          *matCellDef="let element"
          [class.sticky-col]="freezeFirstColumn && i === 0"
          [class.fixed-col]="freezeFirstColumn && i !== 0"
          [ngClass]="getColorClass(col, element[col])"
          (mouseenter)="hoveredRow = element"
          (mouseleave)="hoveredRow = null"
        >
          <ng-container *ngIf="col === 'Ltp' && hoveredRow === element; else defaultValue">
            <button class="btn btn-sm btn-success invest-btn" (click)="invest.emit(element)">
              Invest
            </button>
          </ng-container>
          <ng-template #defaultValue>
            {{ formatValue(col, element[col]) }}
          </ng-template>
        </td>
      </ng-container>

      <ng-container *ngIf="showActions" matColumnDef="actions">
        <th mat-header-cell *matHeaderCellDef></th>
        <td mat-cell *matCellDef="let element" class="text-end">
          <button class="btn btn-sm btn-warning me-2 fixed-btn" (click)="onEdit(element)">
            Edit
          </button>
          <button class="btn btn-sm btn-danger fixed-btn" (click)="onDelete(element)">
            Delete
          </button>
        </td>
      </ng-container>

      <tr mat-header-row *matHeaderRowDef="allColumns"></tr>
      <tr mat-row *matRowDef="let row; columns: allColumns"></tr>
    </table>
  </div>

  <div class="d-flex justify-content-between align-items-center mt-3">
    <div class="small">
      Showing {{ startIndex + 1 }} to {{ endIndex }} of {{ data.length }} entries
    </div>
    <nav>
      <ul class="pagination pagination-sm mb-0">
        <li class="page-item" [class.disabled]="currentPage === 1">
          <button class="page-link" (click)="goToPage(currentPage - 1)">Previous</button>
        </li>
        <li class="page-item" *ngFor="let page of pages" [class.active]="page === currentPage">
          <button class="page-link" (click)="goToPage(page)">
            {{ page }}
          </button>
        </li>
        <li class="page-item" [class.disabled]="currentPage === totalPages">
          <button class="page-link" (click)="goToPage(currentPage + 1)">Next</button>
        </li>
      </ul>
    </nav>
  </div>
</div>
